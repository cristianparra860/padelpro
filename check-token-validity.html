<!DOCTYPE html>
<html>
<head>
    <title>Verificar Token JWT</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 800px;
            margin: 50px auto;
            padding: 20px;
        }
        .token-info {
            background: #f5f5f5;
            padding: 20px;
            border-radius: 8px;
            margin: 20px 0;
        }
        .valid { color: green; }
        .invalid { color: red; }
        pre {
            background: #000;
            color: #0f0;
            padding: 10px;
            border-radius: 4px;
            overflow-x: auto;
        }
        button {
            padding: 10px 20px;
            margin: 5px;
            cursor: pointer;
        }
    </style>
</head>
<body>
    <h1>üîê Verificador de Token JWT</h1>
    
    <div class="token-info">
        <h3>Token en localStorage:</h3>
        <div id="tokenDisplay"></div>
    </div>

    <div>
        <button onclick="checkToken()">Verificar Token</button>
        <button onclick="decodeToken()">Decodificar Token</button>
        <button onclick="clearToken()">Limpiar Token</button>
        <button onclick="testLogin()">Test Login</button>
    </div>

    <div id="result"></div>

    <script>
        function checkToken() {
            const token = localStorage.getItem('auth_token');
            const display = document.getElementById('tokenDisplay');
            
            if (!token) {
                display.innerHTML = '<p class="invalid">‚ùå No hay token en localStorage</p>';
                return;
            }

            display.innerHTML = `
                <p class="valid">‚úÖ Token encontrado</p>
                <p><strong>Longitud:</strong> ${token.length} caracteres</p>
                <p><strong>Primeros 50 chars:</strong> ${token.substring(0, 50)}...</p>
                <p><strong>Token completo:</strong></p>
                <pre>${token}</pre>
            `;
        }

        function decodeToken() {
            const token = localStorage.getItem('auth_token');
            const result = document.getElementById('result');
            
            if (!token) {
                result.innerHTML = '<p class="invalid">‚ùå No hay token para decodificar</p>';
                return;
            }

            try {
                // Decodificar el payload del JWT (parte central)
                const parts = token.split('.');
                if (parts.length !== 3) {
                    result.innerHTML = '<p class="invalid">‚ùå Token no es un JWT v√°lido (debe tener 3 partes separadas por puntos)</p>';
                    return;
                }

                const payload = JSON.parse(atob(parts[1]));
                const now = Math.floor(Date.now() / 1000);
                const isExpired = payload.exp && payload.exp < now;

                result.innerHTML = `
                    <h3>Payload Decodificado:</h3>
                    <pre>${JSON.stringify(payload, null, 2)}</pre>
                    <p><strong>Emisi√≥n:</strong> ${payload.iat ? new Date(payload.iat * 1000).toLocaleString() : 'N/A'}</p>
                    <p><strong>Expiraci√≥n:</strong> ${payload.exp ? new Date(payload.exp * 1000).toLocaleString() : 'N/A'}</p>
                    <p class="${isExpired ? 'invalid' : 'valid'}">
                        ${isExpired ? '‚ùå Token EXPIRADO' : '‚úÖ Token V√ÅLIDO (no expirado)'}
                    </p>
                `;
            } catch (error) {
                result.innerHTML = `<p class="invalid">‚ùå Error al decodificar: ${error.message}</p>`;
            }
        }

        function clearToken() {
            localStorage.removeItem('auth_token');
            document.getElementById('tokenDisplay').innerHTML = '<p class="valid">‚úÖ Token eliminado</p>';
            document.getElementById('result').innerHTML = '';
        }

        async function testLogin() {
            const result = document.getElementById('result');
            result.innerHTML = '<p>üîÑ Realizando login de prueba...</p>';

            try {
                const response = await fetch('http://localhost:9002/api/auth/login', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    credentials: 'include',
                    body: JSON.stringify({
                        email: 'club.admin@padelpro.com',
                        password: 'Pass123!'
                    })
                });

                const data = await response.json();

                if (response.ok && data.token) {
                    localStorage.setItem('auth_token', data.token);
                    result.innerHTML = `
                        <p class="valid">‚úÖ Login exitoso</p>
                        <p>Token guardado en localStorage</p>
                        <button onclick="checkToken(); decodeToken();">Ver Token Nuevo</button>
                    `;
                } else {
                    result.innerHTML = `<p class="invalid">‚ùå Login fall√≥: ${data.error || 'Error desconocido'}</p>`;
                }
            } catch (error) {
                result.innerHTML = `<p class="invalid">‚ùå Error: ${error.message}</p>`;
            }
        }

        // Auto-check al cargar
        window.onload = () => {
            checkToken();
            if (localStorage.getItem('auth_token')) {
                decodeToken();
            }
        };
    </script>
</body>
</html>
